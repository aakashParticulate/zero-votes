# ZVotes by Zero Group - JavaEE Course 2014

## TODOs

* bei umfrage erstellen --> copy von recipientlist zu eigenstÃ¤ndigen participants
* poll items auf organisier restrikten
* dashboard content
* statistiken / ergebnisse von beendeten polls
* emailbenachrichtigungen nach dem start
* emailbenachrichtigungen vor ablauf - ohne vote
* tracking wer gevotet hat
* frontend voting


## Getting Started

### Local
* install postgres 9.3  [link](http://postgresapp.com/)
* setup postgres

    ```
CREATE USER zvotes_db_user;
ALTER USER zvotes_db_user WITH PASSWORD 'zvotes_db_pass';
ALTER USER zvotes_db_user CREATEDB;
ALTER USER zvotes_db_user WITH SUPERUSER;
CREATE DATABASE zvotes_db_name;
GRANT ALL ON DATABASE zvotes_db_name TO zvotes_db_user;
    ```

### Glassfish

* Open http://localhost:4848/
* Goto: Konfigurationen --> server-config --> Sicherheit --> Realms
* Create new one with:
    * name: `uniko-ldap-realm`
    * class-name: `com.sun.enterprise.security.auth.realm.ldap.LDAPRealm`
    * JAAS-Kontext: `ldapRealm`
    * Verzeichnis: `ldaps://ldap.uni-koblenz.de`
    * Basis-DN: `dc=uni-koblenz-landau,dc=de`
    * Gruppen zuweisen: `VALIDUSER`
* Add some additional Attributes:
    * search-filter: `(uid=%s)`
    * group-search-filter: `(member=%d)`
    * group-base-dn: `dc=uni-koblenz-landau,dc=de`


## Fulfilled Specifications

1. __Polls__

    1.1 The system supports electronic polls with one or more items. (Set)
    
    1.2 Each title of a poll is unique in the system. (Controller validated and Unique Fields)
    
    1.3 A poll has a description. It is displayed on the voting page, right below the poll name.
    
    1.4 The poll has start and end time. When a poll is published, it will be started at the start time via an asynchronous task. It will be also finished via such a task.
    
    1.5 Each poll must have at least one item.
    
    1.6 Each poll can contain one to arbitrary many items in one poll.

2. __Poll states__

    2.1 When a poll is created, it's pollstate is PREPARING. When it is published it will be PUBLISHED. At the start time it's set to STARTED. After the first vote it's VOTING. At the end time it is set to FINSIHED.
    
    2.2 When all the participants subbmited their votes, the pollstate is set to FINISHED.
    
    2.3 An organizer is able to extend the end date, while the poll is not finished.

3. __Organizers__

    3.1 Every university member can login via LDAP with username and password and automatically has a organizer instance.
    
    3.2 Working, see 3.1
    
        3.2.1 Working, see 3.1
        
        3.2.2 The system uses LDAP for login.
    
    3.3 An organizer is able to conduct arbitrary many polls.
    
    3.4 The organizer is able to see a preview of the poll. This is possible via the preview button in the account panel.
    
    3.5 An organizer can add other organizers to a poll.

      3.5.1 Working, see 3.5
      
      3.5.2 It is not possible for a organizer to remove herself from a poll.

4. __Administrators__

    4.1 The system provides an administrator role.

    4.2 The administrator has the ability to delete polls.
    
    4.3 The administrator is not able to see votes or results of polls.
    
    4.4 Using LDAP, see 3.1

5. __Participants__

    5.1 An organizer can add 3 to arbitrary participants to a poll.
    
    5.2 Each participant is identified by her email address.
    
    5.3 The system supports participants from outside the university.
    
    5.4
    
    5.5
    
    5.6

6. __Participant lists__

    6.1 The organizer must be able to modify the participant list until the poll is PUBLISHED.
    
    6.2 The system provide a means to comfortably create participant lists by pasting a list of email addresses. KLIPS, SpreadSheets, are supported.
    
    6.3 An organizer can store recipient lists for an easy reuse of participant lists.
    
        6.3.1 The recipient lists are private for each organizer.
        
        6.3.2 Each recipient list has a unique title for each organizer.

7. __Tokens__

    7.1 The token is generated by uuid.
    
    7.2 Each token is unique in the system.
    
    7.3 The token is a uuid with a length of 32. It's very improbale to forge a valid token.

8. __Anonymity__

    8.1 The system ensures anonymity as good as it is possible.
    
    8.2 As long as the database is not logged via an database-administrator it is not possible to identify which participant submitted which vote.
    
    8.3 As long as the database is not logged via an database-administrator it is not possible to identify which token was used for which vote.

9. __Participation tracking__

    9.1 An organizer can activate participation tracking per poll.
    
    9.2 If participation tracking is enabled a reminder email can be send to participants, who did not vote until this time.

10. __Submitting a vote__

    10.1 The system provides a webpage to enter a token, and another to submit a vote. This ensures that no person can see polls, items and options which should not be public.
    
    10.2 See 10.1
    
    10.3 The token field can be prefilled via an URL. The history stack gets changed via Javascript to ensure it's not possible for other users to use browser functionality like back or forth to get the user's token. **
    
    10.4 After the token was verified the system displayes the poll, items and options.
    
    10.5 On the bottom of a page is a button to submit, cancel and abstain from all items.
    
    10.6 After the vote the token is marked as used. It's not possible to change a vote or reuse the token.
    
    10.7
    
    10.8 The token is reusable if no vote was submitted.
    
    10.9 The system ensures that it's not possible to recover previous choices.
    
    10.10 Working, see 10.9

11. __Abstain from voting__

    11.1 It's possible to abstain from a specific item, displayed as option, or to abstain from all items, displayed as button at the bottom of the voting page.
    
    11.2 See 11.1

12. __Types of items__

    12.1 Each item has one of the types "YES/NO", "1 of N" and "M of N".
    
    12.2 Each item has a unique title in the scope of a poll.
    
    12.3 Each option has a shortname and a description.
    
    12.4 "YES/NO" items has yes and no options.
    
    12.5 "1 of N" items give participants the possiblity to vote for 1 of two or more options.
    
    12.6 "M of N" items give participants the possiblity to vote for M of M or more options.
    
    12.7 The system supports freetext options at "1 of N" or "M of N" items.
    
    12.8 At "M of N" items, the participant can choose 1 to M predefined options and enter 1 to M own options. Only 1 to M options overall are legit.

13. __Results__

    13.1 An organizer is able to view the results after the poll is finished.
    
    13.2 Nobody is able to see the results of a poll until the poll is finished.
    
    13.3 The System provide a means to publish results. (by sharing a link)
    
    13.4 The system does not show results of polls with less than 3 submitted votes.
    
    13.5 The system shows the amount of votes for each option and the amount of abstentions for each item.
    
    13.6 The system displays the results as bar diagrams, using bootstrap-progressbars.
    
    13.7 The system prints out wether an option is winner due to relative, simple or absolute majority

14. __User interface__

    14.1 The system uses Twitter Bootstrap, Bootstrap-Progressbar, Toastr (used for messages), Boostrap-Datetimepicker, Font-Awesome (Icons), Highcharts (Charts)
    
    14.2 The system uses a few Javascripts for a better user experience.
    
    14.3 The system uses a technology for serving nicer URLs, calls Rewrite. It enables URL-changing e.g it changes account/poll_list.xhtml to /account/polls/
    
    14.4 Using Twitter Bootstrap, see 14.1, the web page uses a responsive design.
    
    14.5 See 14.4
    
    14.6 The user interface is realized with JSF.

15. __Security, encrypted communication__

    15.1 We are convinced that the storage of encrypted passwords is generally unsafe because if the secret key gets leaked - all passwords can be decrypted so we choose to hash all passes (with a secret hash)
    
    15.2 We are using the RedirectToHttpsFilter on /*. To include the welcome-file we are using a WelcomeServlet to redirect von / to the actual welcome file.
    
    15.3 

16. __Internationalization__

    16.1 ZVotes-web/src/main/java/com/zero/votes/beans/LanguageBean, Languages are represented in a ResourceBundle in ZVotes-web/src/main/resources/com/zero/votes/Locale_LANGUAGE_CODE in Template activated via: <f:view locale="#{language.localeCode}"/>, plus entries in WEB-INF/faces-config.xml, Internationalized Strings available via #{msg.STRINGNAME}
    
    16.2 Available in Footer via LanuageBean and Drop-Down to Select.
    
    16.3 FacesContext.getCurrentInstance().getExternalContext().getRequestLocale();
    
    16.4 The language switch is realised with a form select in the footer on the right side which autosubmits itself on selection change.

17. __Browser support__

    17.1 The system is optimized for the current Chrome and Firefox browsers.
